<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      mark cerqueira &middot; well-rounded nerd
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/tags.css">
  <link rel="stylesheet" href="/public/css/v1.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source%20Sans%20Pro">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0d">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">home</a>
    <a class="sidebar-nav-item" href="/about/">about</a>     
    <a class="sidebar-nav-item" href="/archive/">archive</a>
    <a class="sidebar-nav-item" href="/fitness/">fitness</a>
    <a class="sidebar-nav-item" href="/projects/">projects</a>
  </nav>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">mark cerqueira</a>
            <small>well-rounded nerd</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/07/10/authenticating-programmatically-sent-emails/">
        Authenticating Programmatically Sent Emails
      </a>
    </h1>

    <span class="post-date">10 Jul 2016</span>

    <p>Work on the Ruby and Sinatra project continues and this weekend I worked on creating a helper method for sending emails so I can have users confirm the emails they used to register. I wanted to send emails from a mailbox I set up on a custom domain I’m hosting with DreamHost. I created a mailbox on DreamHost’s admin panel and with the <a href="https://github.com/mikel/mail">mail</a> Ruby gem it was pretty straightforward to get emails sent.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"> 
<span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>

  <span class="c1"># Configure mail gem</span>
  <span class="c1"># You can use the config_env gem to save sensitive information (https://github.com/SergXIIIth/config_env)</span>
  <span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:address</span>              <span class="o">=&gt;</span> <span class="s1">'www.yourdomain.com'</span><span class="p">,</span>
              <span class="ss">:port</span>                 <span class="o">=&gt;</span> <span class="mi">587</span><span class="p">,</span>
              <span class="ss">:user_name</span>            <span class="o">=&gt;</span> <span class="s1">'welcome@yourdomain.com'</span><span class="p">,</span>
              <span class="ss">:password</span>             <span class="o">=&gt;</span> <span class="s1">'yourpassword'</span><span class="p">,</span>
              <span class="ss">:authentication</span>       <span class="o">=&gt;</span> <span class="s1">'plain'</span><span class="p">,</span>
              <span class="ss">:enable_starttls_auto</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
              <span class="ss">:openssl_verify_mode</span>  <span class="o">=&gt;</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span> <span class="p">}</span>
  
  <span class="no">Mail</span><span class="p">.</span><span class="nf">defaults</span> <span class="k">do</span>
    <span class="n">delivery_method</span> <span class="ss">:smtp</span><span class="p">,</span> <span class="n">options</span>
  <span class="k">end</span>
	
  <span class="n">get</span> <span class="s1">'/mailtest/?'</span> <span class="k">do</span>
    <span class="no">Mail</span><span class="p">.</span><span class="nf">deliver</span> <span class="k">do</span>
      <span class="n">to</span> <span class="n">user</span><span class="vi">@yourdomain</span><span class="p">.</span><span class="nf">com</span>
      <span class="n">from</span> <span class="s1">'Welcome &lt;welcome@yourdomain.com'</span>
      <span class="n">subject</span> <span class="s1">'Test Subject'</span>
      <span class="n">body</span> <span class="s1">'Test Body'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Hit and the endpoint and you’re done! Or are you? To the Gmail inbox!</p>

<div>
	<img class="rounded-corners" style="max-width: 800px; border: 0px;" src="/assets/images/posts/2016-07-10/spammer.png" />
	<p class="caption-text" style="line-height: 1.5em; margin-bottom: 24px;"><strong>Gmail has some doubts!</strong></p>
</div>

<p>All looks good except Gmail ominously warns us: <strong>“Gmail couldn’t verify that chuckpad.io actually sent this message.”</strong> This means “Gmail doesn’t know if the message is coming from the person who appears to be sending it,” which makes our messages excellent candidates to get caught by Gmail’s spam filters! Read more about authenticated messages <a href="https://support.google.com/mail/answer/180707?hl=en">here</a>.</p>

<p>After some digging around, I learned about <strong>Sender Policy Framework (SPF) records</strong>. Basically, a DNS record can have some metadata which identifies which servers are permitted to send email on behalf of the domain. DreamHost’s default <a href="https://help.dreamhost.com/hc/en-us/articles/220854287-What-SPF-records-do-I-use-">“SPF information doesn’t include DreamHost’s mail servers”</a> because you can always opt to host your domain’s mail servers elsewhere. Fortunately, this can be easily remedied by <a href="https://help.dreamhost.com/hc/en-us/articles/216106197-How-do-I-add-an-SPF-record-">adding the SPF record</a> <strong>v=spf1 include:netblocks.dreamhost.com</strong> to our domain’s DNS record.</p>

<div>
	<img class="rounded-corners" style="max-width: 800px; border: 0px;" src="/assets/images/posts/2016-07-10/spf.png" />
	<p class="caption-text" style="line-height: 1.5em; margin-bottom: 24px;"><strong>Gmail's doubts are gone!</strong></p>
</div>

<p>Give the DNS caches of the world a few hours to refresh, try again, and boom! <strong>Success! Programmatic and authenticated!</strong></p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/07/06/thoughts-on-star-ocean-5/">
        Thoughts on Star Ocean 5
      </a>
    </h1>

    <span class="post-date">06 Jul 2016</span>

    <p>A week after its release, I beat <strong>Star Ocean Integrity and Faithlessness</strong> a.k.a. Star Ocean 5. Here are some of my thoughts on the game.</p>

<ul>
  <li>The game is <strong>short</strong>: I beat it in 24 hours doing about 70% of the side quests.</li>
  <li>The <strong>story</strong> is pretty poor. It’s easily the weakest in the series.</li>
  <li>I liked the cast of <strong>characters</strong> and the voice-acting was pretty good! Each character was unique and memorable. The story didn’t do the characters enough justice but the optional Private Actions gave some opportunities for development.</li>
  <li>The battle system is good, but the <strong>AI was terrible</strong> at making all characters useful. Heal spells always seemed to be improperly timed!</li>
  <li>How <strong>cutscenes</strong> were implemented was lazy and really hurt the delivery of the already-bad story. Cutscenes were rendered without any special handling and would let the player walk around and control the camera. This likely saved a lot of development time as cutscenes did not need to be “directed” but really cheapened each scene.</li>
  <li>The <strong>camera</strong> was bad: too close to the character and too jarring when moving around.</li>
  <li>There was too much <strong>backtracking</strong> without early fast travel options.</li>
  <li>The option to have orchestrated <strong>battle music</strong> from Valkyrie Profile was great! This reminded me how much I want Valkyrie Profile 3 to happen.</li>
</ul>

<div>
	<img class="rounded-corners" style="max-width: 800px; border: 0px;" src="/assets/images/posts/2016-07-06/so5.jpg" />
	<p class="caption-text" style="line-height: 1.5em; margin-bottom: 24px;"><strong>So much potential squandered!</strong></p>
</div>

<p><strong>Conclusion:</strong> it’s the weakest entry in the series so far. Even though I just finished trashing the game pretty hard, I powered through it because it was fun to play (I’m a masochist). Along with the Tales series I always considered Star Ocean to be a reliable source for decent JRPGs. This game sadly makes me question that. <strong>I would not recommend buying the game at the $60 price-tag, but if you find this game in the bargain bin, I’d recommend picking it up if you’re hungry for a JRPG.</strong></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/06/28/dont-forget-the-license/">
        Don't Forget the License!
      </a>
    </h1>

    <span class="post-date">28 Jun 2016</span>

    <p>If you write some code and want to share it with the world, <strong>don’t forget to add a license</strong>! Posting code on a public repository on GitHub and allowing people to incorporate that code into their own products are not one and the same. So add a license please!</p>

<p>As will all things, there are tons of licenses for you to pick from. <a href="http://choosealicense.com/">choosealicense.com</a> has a nice <a href="http://choosealicense.com/licenses/">guide</a> on the most commonly used licenses. Basically, if you want to let people use your code without too many restrictions go with the <strong>MIT License</strong>.</p>

<p>So go forth! Code, slap a license on it, and share it!</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/06/22/resetting-sequences-postgresql-heroku/">
        Resetting Sequences in PostgreSQL on Heroku
      </a>
    </h1>

    <span class="post-date">22 Jun 2016</span>

    <p>Today <a href="/2016/01/26/evernote-hackathon-report">Glatering</a> – a world-class Rails app with a Postgres database I’m running on Heroku – kicked the bucket! Time to debug… To the Heroku logs!</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
~ heroku logs --app <span class="o">{</span>app_name<span class="o">}</span>
    ActionView::Template::Error
    PG::UniqueViolation: ERROR: duplicate key value violates unique constraint <span class="s2">"events_pkey"</span>
    Rendered welcome/index.html.erb within layouts/application <span class="o">(</span>324.8ms<span class="o">)</span>
    Completed 500 Internal Server Error <span class="k">in </span>413ms <span class="o">(</span>ActiveRecord: 90.0ms<span class="o">)</span>
    DETAIL: Key <span class="o">(</span>id<span class="o">)=(</span>47<span class="o">)</span> already exists.</code></pre></figure>

<p>Looks like when we were creating a new event object the auto-assigned id for it (which has to be unique) already existed in the database. We were trying to use id 47 when the database had an event with that id already in it. This is weird because that id should be assigned and auto-incremented for us.</p>

<p>So what do we do? <strong>Get Postgres to check itself</strong> a.k.a. reset the value “events_pkey” to a valid value.</p>

<p>To connect to the database, I use my favorite Postgres GUI <a href="https://eggerapps.at/postico/">Postico</a>. All the information you need to connect to the database (e.g. user, password, host, database name) is in the Heroku DATABASE_URL environmental variable in the Settings section of the app dashboard.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
~ <span class="nb">echo</span> <span class="nv">$DATABASE_URL</span>
    postgres://<span class="o">{</span>user<span class="o">}</span>:<span class="o">{</span>password<span class="o">}</span>@<span class="o">{</span>host<span class="o">}</span>:<span class="o">{</span>port<span class="o">}</span>/<span class="o">{</span>database<span class="o">}</span></code></pre></figure>

<p>Once connected, click on SQL query, paste the query below (and replace events with the name of the table you’re having issues with), and hit Execute Statement.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
SELECT pg_catalog.setval<span class="o">(</span>pg_get_serial_sequence<span class="o">(</span><span class="s1">'events'</span>, <span class="s1">'id'</span><span class="o">)</span>, MAX<span class="o">(</span>id<span class="o">))</span> FROM events;</code></pre></figure>

<p>Boom! Hopefully your database is still in one piece, your Postgres sequence should be reset it, and it won’t generate duplicate ids any more!</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/06/14/json-arrays-ruby/">
        Producing JSON Arrays in Ruby
      </a>
    </h1>

    <span class="post-date">14 Jun 2016</span>

    <p>I’ve been working on a project and building the backend with Ruby and Sinatra. So far so good, until I wanted to take a list of objects I fetched from ActiveRecord and produce a JSON array. I had a function set up to JSONify a single object:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Returns passed model as a hash</span>
<span class="c1"># This is separate from to_json because we'll use it later!</span>
<span class="k">def</span> <span class="nf">to_hash</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="n">model</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="n">model</span><span class="p">.</span><span class="nf">name</span>
  <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Returns JSON for given model</span>
<span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
  <span class="n">to_hash</span><span class="p">(</span><span class="n">model</span><span class="p">).</span><span class="nf">to_json</span>
<span class="k">end</span></code></pre></figure>

<p>Extending this to produce a JSON array for a bunch of model objects is simple for anyone who is familiar with Ruby…. Something I’m clearly not! Here’s the clean solution I eventually got:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Returns JSON for given models</span>
<span class="k">def</span> <span class="nf">to_json_list</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">models</span><span class="p">.</span><span class="nf">each_with_object</span><span class="p">([])</span> <span class="p">{</span> <span class="o">|</span><span class="n">model</span><span class="p">,</span> <span class="n">array</span><span class="o">|</span> <span class="n">array</span> <span class="o">&lt;&lt;</span> <span class="n">to_hash</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="p">}.</span><span class="nf">to_json</span>
<span class="k">end</span></code></pre></figure>

<p>For the laughs (and sadness), here was my initial (and ghetto) implementation of to_json_list:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Ghetto but I wasn't able to find a better way to do this!</span>
<span class="k">def</span> <span class="nf">to_json_list</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">result</span> <span class="o">=</span> <span class="s1">'['</span>
  <span class="n">models</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">model</span><span class="o">|</span>
    <span class="n">result</span> <span class="o">+=</span> <span class="n">to_json</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">models</span><span class="p">.</span><span class="nf">length</span>
      <span class="n">result</span> <span class="o">+=</span> <span class="s1">','</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">result</span> <span class="o">+=</span> <span class="s1">']'</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>Replacing the above method with the single-line version felt almost as good as removing that # Ghetto comment!</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="/">Newer</a>
    
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
