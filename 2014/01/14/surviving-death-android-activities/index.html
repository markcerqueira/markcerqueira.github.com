<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Surviving Death - Android Activities &middot; mark cerqueira
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/tags.css">
  <link rel="stylesheet" href="/public/css/v1.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source%20Sans%20Pro">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0d">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">home</a>
    <a class="sidebar-nav-item" href="/about/">about</a>     
    <a class="sidebar-nav-item" href="/archive/">archive</a>
    <a class="sidebar-nav-item" href="/fitness/">fitness</a>
    <a class="sidebar-nav-item" href="/projects/">projects</a>
  </nav>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">mark cerqueira</a>
            <small>well-rounded nerd</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Surviving Death - Android Activities</h1>
  <span class="post-date">14 Jan 2014</span>
  <p>It’s a fact of life: your Android activities aren’t always going to be the center of attention. They can be backgrounded either because your entire app is backgrounded or because another activity of your app is pushed onto the activity stack. Even sadder, while backgrounded, your activity (and its state) can be entirely destroyed. If you don’t handle this case, the eventual return of your activity will be less-than-ideal. Fortunately, it’s not that hard to handle this problem.</p>

<!--break-->

<p>1. <strong>Use Android Annotations.</strong> Besides being used in the forthcoming examples, Android Annotations helps you write simpler code. Everyone loves simpler code. <a href="http://androidannotations.org/">Get it now!</a></p>

<p>2. <strong>Develop and test with “Don’t keep activities” option turned on.</strong> Under normal circumstances, activities can be destroyed when you background them in low-memory situations. Enabling this option (in Settings ~&gt; Developer Options) will force a pathological low-memory environment and activities will be destroyed as soon as you leave them. Don’t be lazy. Turn on this option, and make sure your activities can handle getting sent to the grave and getting revived.</p>

<p>3. <strong>Use static methods to generate intents for your activities.</strong> Using helper methods to generate ready-to-go intents forces you to pass data you’ll need for your activity to function properly. The data you pass in to these methods is data you will likely be concerned about when activities start getting destroyed and recreated. This is also useful if you need to later pass additional data to your activity. Add any new parameters, hit compile, and fix all the errors!</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// this static method generates an intent for starting the ResilientActivity class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Intent</span> <span class="nf">generateResilientActivityIntent</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">String</span> <span class="n">accountId</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">// _ after the class name because it's using Android Annotations</span>
    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">ResilientActivity_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">ACCOUNT_ID_KEY</span><span class="o">,</span> <span class="n">accountId</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">intent</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>4. <strong>Figure out what to save when an activity is destroyed and @InstanceState it.</strong> Both of these are easy. First, any of the parameters you pass to your intent-generating methods you likely want to save. You’d used them to create the activity, so you’ll want them again when you recreate the activity. For these values, create fields and annotate them with @InstanceState. If your activity is destroyed, the code generated by Android Annotations will automagically save these fields to the bundle. If you’ve got complex objects, this will work if they implement the Parcelable interface.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// fields annotated with @InstanceState cannot be private</span>
<span class="nd">@InstanceState</span> <span class="kd">protected</span> <span class="n">String</span> <span class="n">mAccountId</span><span class="o">;</span></code></pre></figure>

<p>5. <strong>In onCreate, @InstanceState will be handled for you so just check for a null savedInstanceState and parse the data out yourself.</strong> If you’ve set everything else up, the only thing left to do is figure out what state you’re in in your onCreate method. If the activity is getting created for the first time, the Bundle passed in will be null and you’ll want to parse out all that data you stashed into your Intent. Otherwise, you’re getting recreated and the onCreate super method will handle restoring all annotated fields (courtesy of Android Annotations).</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// if we are getting recreated, savedInstanceState will not be null</span>

    <span class="c1">// the call to super.onCreate will handle restoring any fields annotated with @InstanceState</span>
	<span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="c1">// if savedInstanceState is null, we are getting created for the first time,</span>
	<span class="c1">// so parse out the data from the intent</span>
	<span class="k">if</span><span class="o">(</span><span class="n">savedInstanceState</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">mAccountId</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">ACCOUNT_ID_KEY</span><span class="o">);</span>	
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>That’s it!</strong> You can test the resilience of your activities by backgrounding your application or going to another activity and then returning back to that activity. In the hands of your customers, expect your app to be backgrounded for long periods of time and running on devices where a plethora of other apps are running. Eventually, an activity is going to pay the price and get sent to the grave to free up resources. Will your app’s return to life be elegant and seamless, or a disaster?</p>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/08/04/changing-progress-bar-color/">
            Changing Progress Bar Spinner Color
            <small>04 Aug 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/07/30/ruby-datetime-nsdate/">
            Ruby DateTime to Objective-C NSDate
            <small>30 Jul 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/07/28/concert-review-final-symphony/">
            Concert Review: Final Symphony, San Francisco, 7/28/16
            <small>28 Jul 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
